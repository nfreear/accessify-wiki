<!doctype html><html lang=en id=acfy-build ><meta charset=utf-8 />
<title>Accessify Wiki compiler (Google Closure)</title>

<link rel=stylesheet href="pix/site.css" />


<h1>Accessify Wiki compiler</h1>

<form action="http://closure-compiler.appspot.com/compile" method="POST">
  <p id=_site_id><label for=site-id >Site ID</label> <input id=site-id
    value="Fix:Example_fixes" />

  <p><label for=r-cl >Compilation level</label>
   <select id=r-cl name="compilation_level">
     <option value="WHITESPACE_ONLY">Whitespace only (readable)</option>
     <option value="SIMPLE_OPTIMIZATIONS" selected >Simple optimizations (small)</option>
   </select>

  <fieldset id=detail >
  <p><label for=r-of >Output format</label> <input id=r-of name="output_format"
    value="json" title="'text' or 'json'" />
  <p><label for=r-oi >Output info</label> <input id=r-oi name="output_info"
    value="compiled_code" />
  <p><label for=r-oi-2 >Output info 2</label> <input id=r-oi-2 name="output_info"
    value="statistics" />

  <p><label for=r-fn >File name</label> <input id=r-fn name=output_file_name
    value="accessifyhtml5-My_Site.min.js" />
  <p><label for=r-ff >Formatting</label> <input id=r-ff name=formatting
    value="print_input_delimiter" />

  <p><label for=url-1 >Code URL 1</label> <input id=url-1 name=code_url value=
    "http://dl.dropbox.com/u/3203144/wai-aria/inpage-header.js" />
  <p><label for=url-2 >Code URL 2</label> <input id=url-2 name=code_url value=
    "http://accessifywiki.appspot.com/browser/js/accessifyhtml5.js" />
  <p><label for=url-fx >Fixes URL</label> <input id=url-fx name=code_url value=
  "http://accessifywiki.appspot.com/fix?q=Fix:Example_fixes&min=1&callback=__accessify_IPG"
  />

  <p id=_js_code ><label for=js_code >Javascript glue code</label>
  <textarea id=js_code name="js_code" cols="50" rows="5">
  function __accessify_IPG(fixes) {
    "use strict";

    var res,
      pat = /debug/,
      L = document.location;

    function log(s) {
      if (typeof console !== "undefined" && (L.search.match(pat) || L.hash.match(pat))) {
        console.log(arguments.length > 1 ? arguments : s);
      }
    }

    log("AccessifyHTML5");

    res = AccessifyHTML5(false, fixes);

    log(res);
  }
  </textarea>
  </fieldset>

  <p><button type=submit >Build</button> <button id=bn-d type=button >Details</button>
      <span id=status ><!--TODO: --></span>

  <fieldset id=output >
  <p><label for=op-js >Output Javascript</label> <textarea id=op-js ></textarea>
  <p><label>Output file</label> <a id=op-url href="#_placeholder_">default.js</a>
  <p><label>Statistics</label> <span id=op-num ></span>
  </fieldset>
  
</form>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
(function () {

  var
    $form = $("#acfy-build form"),
    $site_id = $("#site-id", $form),
    $code_url_fx = $("#url-fx", $form),
    $detail = $("#detail", $form),
    stub = "http://closure-compiler.appspot.com",
    sh_time = 600, //400;
    DL = document.location;

  process();

  $("fieldset input, textarea", $form).prop("readonly", "readonly");

  $form.on("submit", function (e) {
    e.preventDefault();

    process();

    var
      data = $form.serialize(),
      url = $form.attr("action");

    $.ajax({
      type: "POST",
      url:  url,
      data: data,
      dataType: "json"
      })
      .done(function (data, stat, jqXHR) {
        var st = data.statistics;

        $("#op-js").val(data.compiledCode);
        $("#op-url")
          .attr("href", stub + data.outputFilePath)
          .text($("#r-fn").val());
        $("#op-num").text("original "+ st.originalSize +
            " bytes; compressed "+st.compressedSize +" bytes.");

        $("#status").text("Compilation was a success!").addClass("ok");
        $("#output").show(sh_time);
        console.log("Success:", jqXHR);
      })
      .fail(function (jqXHR, stat, er) {
        $("#status").text("Compilation errors :(.").addClass("error");
        console.log("Fail:", stat, er, jqXHR);
      });

    console.log("POST:", url);

    $detail.hide(sh_time);
  });

  var show = false;
  $("#bn-d", $form).on("click", function () {
    if (show) {
      $detail.hide(sh_time);
    } else {
      $detail.show(sh_time);
    }
    show = !show;
  });


  function process() {
    var
      m = DL.search.match(/(q|id)=(Fix:[\w\-_]+)/),
      site_id = m ? m[2] : $site_id.val(),
      code_url_fx = $code_url_fx.val().replace("Fix:Example_fixes", site_id);

    $site_id.val(site_id);
    $code_url_fx.val(code_url_fx);

    console.log("Site ID:", site_id, code_url_fx);
  }

  (function embed_test() {
    var DL = document.location;
    if (DL.hash.match(/embed/i) || DL.search.match(/embed/i)) {
      document.body.className += " embed_me";
    }
  })();

})();
</script>
<script src="js/accessify-analytics.js"></script>


<pre>

NDF, 28 March 2014.

* http://accessify.wikia.com/wiki/Build_fix_js?q=Fix:Example_fixes
* https://developers.google.com/closure/compiler/docs/gettingstarted_api
* https://developers.google.com/closure/compiler/docs/api-ref

</pre>

</html>
